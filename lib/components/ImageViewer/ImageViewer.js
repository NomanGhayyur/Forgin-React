"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,c,i,o){return new(i=i||Promise)(function(r,t){function a(e){try{l(o.next(e))}catch(e){t(e)}}function n(e){try{l(o.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,n)}l((o=o.apply(e,c||[])).next())})},__generator=this&&this.__generator||function(a,n){var l,c,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(l)throw new TypeError("Generator is already executing.");for(;o;)try{if(l=1,c&&(i=2&t[0]?c.return:t[0]?c.throw||((i=c.return)&&i.call(c),0):c.next)&&!(i=i.call(c,t[1])).done)return i;switch(c=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,c=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){o.label=t[1];break}if(6===t[0]&&o.label<i[1]){o.label=i[1],i=t;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(t);break}i[2]&&o.ops.pop(),o.trys.pop();continue}t=n.call(a,o)}catch(e){t=[6,e],c=0}finally{l=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__read=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,l=r.call(e),c=[];try{for(;(void 0===t||0<t--)&&!(a=l.next()).done;)c.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return c},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},_this=this,__1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("..")),important_1=require("../../helpers/aphrodite/important"),react_1=__importStar(require("react")),imageviewer_style_1=__importDefault(require("./imageviewer.style")),ImageViewer=react_1.default.forwardRef(function(f,e){var r=(0,react_1.useRef)(null),t=(0,imageviewer_style_1.default)(),a=__read((0,react_1.useState)([]),2),n=a[0],_=a[1],a=__read((0,react_1.useState)(0),2),l=a[0],c=a[1],i=(0,react_1.useCallback)(function(e){var t,e=n[(e=void 0===e?l:e)%n.length];return"string"==typeof e?(t=(t=e.split("/"))[t.length-1],__read(t.split("."),1)[0]||t):e&&e instanceof File?e.name:""},[n,l]),a=(0,react_1.useMemo)(i,[i]),o=(0,react_1.useCallback)(function(e){var t,r=n[e=void 0===e?l:e];0<=e&&r&&(t=document.createElement("a"),r instanceof File&&(t.href=URL.createObjectURL(r)),"string"==typeof r&&(t.href=r),t.download="".concat(i(e)),t.click(),r instanceof File&&URL.revokeObjectURL(t.href),t.remove())},[l,n,i]),s=((0,react_1.useImperativeHandle)(e,function(){return{showModal:function(e,t){t&&t.length?(_(t),null!=(t=r.current)&&t.showModal(e)):n.length&&null!=(t=r.current)&&t.showModal(e)},setActiveIndex:c,setImages:_,downloadImageAtIndex:function(e){if(n[e=void 0===e?-1:e])return o(e)}}},[n,o]),(0,react_1.useCallback)(function(u){return void 0===u&&(u=f.images),__awaiter(void 0,void 0,void 0,function(){var t,r,a,n,l,c,i,o,s;return __generator(this,function(e){switch(e.label){case 0:if(u&&u.length){if(f.useFetch)return[3,1];_(u)}return[3,11];case 1:t=[],r=0,e.label=2;case 2:if(!(r<u.length))return[3,10];if("string"!=typeof(a=u[r]))return[3,8];n={method:"GET",cache:"default"},f.header&&(Array.isArray(f.header)&&f.header.length?n.headers=f.header[r]:!Array.isArray(f.header)&&f.header&&(n.headers=f.header)),e.label=3;case 3:return e.trys.push([3,6,,7]),[4,fetch(a)];case 4:return n=e.sent(),l=a.split("/"),l=l[l.length-1],c=__read(l.split("."),1),c=c[0],o=(i=t).push,s=File.bind,[4,n.blob()];case 5:return o.apply(i,[new(s.apply(File,[void 0,[e.sent()],c||l]))]),[3,7];case 6:return e.sent(),[3,7];case 7:return[3,9];case 8:t.push(a),e.label=9;case 9:return r++,[3,2];case 10:_(t),e.label=11;case 11:return[2]}})})},[f.images,f.useFetch,f.header])),u=((0,react_1.useEffect)(function(){s(f.images)},[f.images,s]),(0,react_1.useMemo)(function(){var e=n[l%n.length];return e instanceof File?URL.createObjectURL(e):e},[n,l])),e=((0,react_1.useEffect)(function(){return function(){URL.revokeObjectURL(u)}},[u]),(0,react_1.useMemo)(function(){return react_1.default.createElement("img",{loading:"lazy",className:(0,__1.css)(t.image),alt:i(),src:u})},[u,t,i]));return react_1.default.createElement(__1.Modal,{onBackdrop:f.onBackdrop,id:f.id,show:f.show,ref:r,className:"".concat((0,important_1.css)(t.container)," ").concat(f.className||""),style:f.style},f.showHeader?react_1.default.createElement("div",{className:(0,__1.css)(t.headingWrapper)},react_1.default.createElement("h3",{style:{flex:.85}},a),1<n.length?react_1.default.createElement("span",{style:{flex:.15},className:"lead"},"[".concat(l+1," / ").concat(n.length,"]")):null):null,1<n.length?react_1.default.createElement("div",{className:(0,__1.css)(t.leftIcon)},react_1.default.createElement(__1.Icon,{onClick:function(){c(function(e){return(e-1+n.length)%n.length})},name:"chevron-left",height:"3.5rem",width:"3.5rem",fill:"var(--bs-body-color)"})):null,react_1.default.createElement("div",{className:(0,__1.css)(t.imageContainer)},e),1<n.length?react_1.default.createElement("div",{className:(0,__1.css)(t.rightIcon)},react_1.default.createElement(__1.Icon,{onClick:function(){c(function(e){return(e+1+n.length)%n.length})},name:"chevron-right",height:"3.5rem",width:"3.5rem",fill:"var(--bs-body-color)"})):null,f.showFooter?react_1.default.createElement("div",{className:(0,__1.css)(t.footerContainer)},react_1.default.createElement("div",{className:(0,__1.css)(t.descriptionContainer)},f.description||null),react_1.default.createElement("div",{className:(0,__1.css)(t.iconContainer)},react_1.default.createElement(__1.Icon,{onClick:o.bind(_this,l),name:"download",height:"1.8rem",width:"1.8rem",fill:"var(--bs-body-color)",className:"m-1 p-1"}),react_1.default.createElement(__1.Icon,{onClick:function(){return window.open(u,"__blank")},name:"box-arrow-up-right",height:"1.8rem",width:"1.8rem",fill:"var(--bs-body-color)",className:"m-1 p-1"}))):null)});ImageViewer.defaultProps={showFooter:!0,showHeader:!0},exports.default=ImageViewer;